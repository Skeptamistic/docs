---
title: "Patron"
description: "Patron API Flow"
sidebarTitle: "Patron API Flow"
---

A patron is a customer of the restaurant.

The patron flow is a model of the customer experience in ordering one or more dishes.

![UJ Patron Pn](/images/UJ_Patron.png)

Each dish is in exactly one category, such as appetizer or main course. To browse dishes, the patron specifies a category. Within the category, the patron can inspect the ingredients and details of each dish before adding one or more dishes to an order (shopping) cart. When the patron is satisfied with the contents of the order cart, the patron sends (places) the order. The system responds with a confirmation message to the patron.

## 1. Browsing

In this step, the patron explores different categories of dishes, such as appetizers or main courses. To focus on a subset of all dishes, the patron then selects a category of dishes.

The request example here is for the Drinks category, which has only a few members.

### Request

The client sends a `GET` request to the `dishes` endpoint for the Drinks category:

```bash
curl -X 'GET' \
  'http://{serverUrl}/dishes?sort=name&order=asc&fields=name|description|ingredients&filter=category.eq~Drinks&offset=0'
```

The request specifies that results are to be sorted in ascending order by the name of the drink (dish). For each drink, the result is to include the name, description, and list of ingredients. (The ingredients information is reused in the next step.)

The request does not limit the quantity of drinks returned because, deliberately for convenience of the example, the Drinks category has only a few members and so pagination of results is not required.

### Response

For a successful request, the server responds with a 200 status code and body of results as specified by the request. For this example, the Drinks category includes exactly six members.

The application does not yet show results to the patron because one or more dishes might require an ingredient that is not sufficiently available. The system checks for ingredients in the next step.

```json
{
  "results": [
    {
      "id": "685895df7e453310d06b167a",
      "name": "Aperol Spritz",
      "station": "beverages",
      "ingredients": [
        {
          "ingredient_id": "685895df7e453310d06b15cb",
          "is_essential": true,
          "_id": "685895df7e453310d06b167b"
        },
        {
          "ingredient_id": "685895df7e453310d06b15ca",
          "is_essential": false,
          "_id": "685895df7e453310d06b167c"
        },
        {
          "ingredient_id": "685895df7e453310d06b15bd",
          "is_essential": true,
          "_id": "685895df7e453310d06b167d"
        },
        {
          "ingredient_id": "685895df7e453310d06b15c4",
          "is_essential": true,
          "_id": "685895df7e453310d06b167e"
        }
      ]
    },
    {
      "id": "685895df7e453310d06b1666",
      "name": "Espresso",
      "station": "beverages",
      "ingredients": [
        {
          "ingredient_id": "685895df7e453310d06b15c4",
          "is_essential": false,
          "_id": "685895df7e453310d06b1667"
        },
        {
          "ingredient_id": "685895df7e453310d06b15e1",
          "is_essential": true,
          "_id": "685895df7e453310d06b1668"
        },
        {
          "ingredient_id": "685895df7e453310d06b15d4",
          "is_essential": true,
          "_id": "685895df7e453310d06b1669"
        }
      ]
    },
    {
      "id": "685895df7e453310d06b1671",
      "name": "Limoncello",
      "station": "beverages",
      "ingredients": [
        {
          "ingredient_id": "685895df7e453310d06b15d7",
          "is_essential": false,
          "_id": "685895df7e453310d06b1672"
        },
        {
          "ingredient_id": "685895df7e453310d06b15ba",
          "is_essential": true,
          "_id": "685895df7e453310d06b1673"
        },
        {
          "ingredient_id": "685895df7e453310d06b15da",
          "is_essential": false,
          "_id": "685895df7e453310d06b1674"
        },
        {
          "ingredient_id": "685895df7e453310d06b15dd",
          "is_essential": true,
          "_id": "685895df7e453310d06b1675"
        },
        {
          "ingredient_id": "685895df7e453310d06b15bf",
          "is_essential": true,
          "_id": "685895df7e453310d06b1676"
        }
      ]
    },
    {
      "id": "685895df7e453310d06b1684",
      "name": "Prosecco",
      "station": "beverages",
      "ingredients": [
        {
          "ingredient_id": "685895df7e453310d06b15c7",
          "is_essential": true,
          "_id": "685895df7e453310d06b1685"
        },
        {
          "ingredient_id": "685895df7e453310d06b15df",
          "is_essential": false,
          "_id": "685895df7e453310d06b1686"
        },
        {
          "ingredient_id": "685895df7e453310d06b15db",
          "is_essential": true,
          "_id": "685895df7e453310d06b1687"
        },
        {
          "ingredient_id": "685895df7e453310d06b15e8",
          "is_essential": true,
          "_id": "685895df7e453310d06b1688"
        }
      ]
    }
  ],
  "total_results": 4
}
```

## 2. Check Ingredient Quantities

To make sure that ingredients are sufficient to make a dish, the system checks ingredient quantities before showing the dish as an option to the patron. The data for each dish specifies which ingredients (if any) are essential. If an essential ingredient is not available in a quantity that is sufficient, the system does not show the dish as available to the patron.

For each essential ingredient, the client requests quantity information. If three ingredients are essential to a dish, then the client sends three requests.

To continue the example, the client requests quantity information for the Negroni drink, the last in the response of the previous step. The first (and only) essential ingredient in the Prosecco has the `ingredient_id` equal to `685895df7e453310d06b1684`.

### Request

The client sends a `GET` request to the ingredients endpoint for only the in-stock quantity of the essential ingredient:

```bash
curl -X 'GET' \
  'http://{serverUrl}/ingredients/685895df7e453310d06b1684?fields=in_stock_qty'
```

### Response

For a successful request, the server responds with a `200` status code and body of results as specified by the request. For this example, the specified ingredient has an in-stock quantity of 84.

```json
{
  "id": "681944cf3daa70417ad11de3",
  "in_stock_qty": 84
}
```

## 3. View Dish Details

After the system validates that the essential ingredients are available for a dish, the system displays the dish as an available option to the patron. The patron then can choose to view the details of the dish. In this example, the patron selects the Negroni drink.

The client retrieves information about a selected dish by using the `dishes` endpoint.

### Request

The client sends a `GET` request to the dishes endpoint, filtering on the dish id. We know from the response from step 1 that the Prosecco dish id is `685895df7e453310d06b1684`.

```bash
curl -X 'GET' \
  'https://{serverUrl}/dishes/685895df7e453310d06b1684?fields=name|image_name|ingredients|price'
```

### Response

For a successful request, the server responds with a `200` status code and body of results as specified by the request. In this case, the client can use the dish details from the response to show the dish details to the patron.

```json
{
  "results": [
    {
      "id": "685895df7e453310d06b15df",
      "name": "Bread Crumbs",
      "in_stock_qty": 40
    },
    {
      "id": "685895df7e453310d06b15db",
      "name": "Chicken Stock",
      "in_stock_qty": 3
    },
    {
      "id": "685895df7e453310d06b15c7",
      "name": "Chili Flakes",
      "in_stock_qty": 20
    },
    {
      "id": "685895df7e453310d06b15e8",
      "name": "Chili Flakes",
      "in_stock_qty": 7
    }
  ],
  "total_results": 4
}
```

## 4. Adding Dishes and Viewing the Cart

The client shows the dishes details. For an order, the patron selects one more dishes and the system shows the dishes in the cart. The patron can view the cart before sending the order.

## 5. Placing an Order

In this step, the patron commits to an order and the system sends the order from the cart to the staff. In this example, the patron orders a single Negroni.

The client places the order by using the `orders` endpoint.

### Request

The client sends a `POST` request that includes the id of a dish that is in the cart, in this example the Prosecco id of `685895df7e453310d06b1684`:

```json
curl -X 'POST' \
  'https://crispy-potato-g75r4x66qx6fwrxg-80.app.github.dev/orders' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d '{
  "name": "Ben",
  "table_number": 18,
  "dish_ids": [ "685895df7e453310d06b1684" ],
  "special_requests": "No peanuts.",
  "scheduled at": null
}'
```

### Response

For a successful request, the server responds with a `201` status code (`Created`) and body of results that includes `order_number`, which is useful later.

```json
{
  "message": "Authorization header required",
  "errors": [
    {
      "path": "/orders",
      "message": "Authorization header required"
    }
  ]
}
```

## 6. Order Confirmation

After the patron commits the cart, the system sends a confirmation messgage to the patron and sends the order details to the staff flow.